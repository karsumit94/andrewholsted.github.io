<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>FajitaNachos</title>
        <meta name="description" content="">
        <meta name="viewport" content="initial-scale=1.0">
        <meta name="google-site-verification" content="4HbcEJrScd-HLuYgKXqzPgDKlZkWgfHyCRvb3IGIwYk" />
        <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet' type='text/css'> 
        <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
        <link rel="icon" type="image/png" href="/images/favicon.png">

        <link href="/css/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/css/main.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/css/pygments.css" media="screen" rel="stylesheet" type="text/css" />
        <script src="/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
  
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

    <body class="Authenticating-with-the-GitHub-API Authenticating-with-the-GitHub-API_index">
               <div id="post-wrap">
    <div id = "post-header">
      <ul>
       <li class = "social"><a href="https://github.com/AndrewHolsted/"> <img src="/images/github.png" /> </a>
        </li>
        <li> <h1><a href ="/">FajitaNachos</a></h1></li>
       <li class = "social"><a href="https://twitter.com/FajitaNachos/"> <img src="/images/twitter.png" /> </a>
        </li>
      </ul>
    </div>
    <div id = "post-container">
      <article>
      	<h1 id = "post-title">Authenticating with the GitHub API</h1>
        <div id = "post-content">
           <p>I&#39;ve been working on a chrome extension for the last few weeks that utilizes the
GitHub API. It&#39;s my first time working with an API and I&#39;ve enjoyed it thus far. 
Everything is written in Javascript with a little Node.js on the server. Here&#39;s 
the process.</p>

<h2>Setup an application on GitHub</h2>

<p>The first thing you need to do is login to your GitHub account. Once logged in, 
click on the wrench icon (account settings) at the top and then click on 
Applications on the left. Click on Register New Application.</p>

<p><img title="GitHub Applications" alt="GitHub-Setup" src="/images/github-app-setup.jpg" /></p>

<p>Now give the application a name, main URL, and callback URL. The 
callback URL is where GitHub will redirect your users to after they successfully 
login. It has to be on the same domain as your main URL. It also needs to be a 
valid http:// URL. GitHub won&#39;t accept &#39;localhost&#39;, &#39;your mom&#39;, etc..</p>

<p><img title="New GitHub Application" alt="New-GitHub-Application" src="/images/github-app-new.jpg" /></p>

<p>Seeing as how I am writing a browser extension, I REALLY didn&#39;t want to have to 
set up a server just for the extension. However, doing the entire Oauth process 
on the client side would expose my GitHub client secret, and that&#39;s never a good 
thing. So in the end, I bit the bullet and set up a simple node.js server.  I 
decided to go with <a title="Nodejitsu" href="https://www.nodejitsu.com/">Nodejitsu</a> instead of using my existing server. I&#39;ll get 
into some of the code down below, but you can use any server you have access too. 
Also, there&#39;s no repercussions to setting up an application on GitHub. It doesn&#39;t 
cost anything, and you can delete it at any time.</p>

<h2>Redirect your users to GitHub and get an Access Code</h2>

<p>When you are ready to authenticate a user you&#39;ll need to send them to GitHub to 
request an access code for you application.</p>

<p>{% highlight javascript %}
    window.open(&#39;https://github.com/login/oauth/authorize?client_id=your-client-id&#39;);
{% endhighlight %}</p>

<p>You can find your client ID on the in your GitHub account settings page under 
Applications. Click on your application name and the client id will be in the 
top right. There are several other parameters you can (and should) append to the 
URL. Here are the available parameters;</p>

<p><strong>client_id</strong>  <em>Required</em> - The client ID you received from GitHub when you registered the application.</p>

<p><strong>redirect_uri</strong> <em>Optional</em>  - URL in your app where users will be sent after authorization.</p>

<p><strong>scope</strong>  <em>Optional</em>  - Comma separated list of <a href="http://developer.github.com/v3/oauth/#scopes">scopes</a>.</p>

<p><strong>state</strong>  <em>Optional</em>  - An unguessable random string. It is used to protect against cross-site request forgery attacks.</p>

<p>You can add any of these parameters to the URL by adding an &amp; between them. For example</p>

<p>{% highlight javascript %}
    window.open(&#39;https://github.com/login/oauth/authorize?client_id=your-client-id&amp;scopes=scopes&amp;state=unguessable-string&#39;);
{% endhighlight %}</p>

<p>Once redirected to GitHub the user will be prompted to login. After they do, 
GitHub will redirect back to the Callback URL you set up with an access code in the url.</p>

<h2>Parse the access code from the URL and exchange it for an auth token</h2>

<p>Once GitHub redirects back to your Callback URL with an access code, you need to exchange it for an auth token.</p>

<p>Get the access code from the URL
```javascript
// Get the authorization code from the url that was returned by GitHub</p>

<p>var authCode = getAuthCode(window.location.href);</p>

<p>// Extract the auth code from the original URL</p>

<p>function getAuthCode(url){
    var error = url.match(/[&amp;\?]error=([^&amp;]+)/);
    if (error) {
        throw &#39;Error getting authorization code: &#39; + error<a title="GitHub Applications" href="/images/github-app-setup.jpg">1</a>;
    }
    return url.match(/[&amp;\?]code=([\w\/-]+)/)<a title="GitHub Applications" href="/images/github-app-setup.jpg">1</a>;
}</p>
<pre class="highlight text">
And exchange this for an auth token by sending a POST request to

```javascript
https://github.com/login/oauth/access_token?client_id=your-client-id&amp;client_secret=your-client-secret&amp;code=your-access-code
</pre>
<p>Your client secret can be found in the same place as your client id from above. 
You should never share this secret with anyone. It&#39;s called a client <em>secret</em> 
for a reason.</p>

<p>Regarding the POST request, I&#39;m using <a title="Gatekeeper.js" href="https://github.com/prose/gatekeeper">Gatekeeper</a> to handle the 
authentication with GitHub on my nodejitsu server. Here is a small snippet of 
relevant code from Gatekeeper. If you want to implement it yourself, grab it 
from GitHub and let me know if you have any questions. The only change I made 
was replacing a deprecated Express call and adding a few small features like 
404 handling.</p>
<pre class="highlight javascript"><span class="kd">function</span> <span class="nx">authenticate</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
        <span class="na">client_id</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">oauth_client_id</span><span class="p">,</span> <span class="c1">//your GitHub client_id
</span>        <span class="na">client_secret</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">oauth_client_secret</span><span class="p">,</span>  <span class="c1">//and secret
</span>       <span class="na">code</span><span class="p">:</span> <span class="nx">code</span>   <span class="c1">//the access code we parsed earlier
</span>    <span class="p">});</span>

    <span class="kd">var</span> <span class="nx">reqOptions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">host</span><span class="p">:</span> <span class="s1">&#39;github.com&#39;</span><span class="p">,</span>
        <span class="na">port</span><span class="p">:</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span>
        <span class="na">path</span><span class="p">:</span> <span class="s1">&#39;/login/oauth/access_token&#39;</span><span class="p">,</span>
        <span class="na">method</span><span class="p">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;content-length&#39;</span><span class="err">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">https</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">reqOptions</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="p">{</span> <span class="nx">body</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">;</span> <span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">access_token</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>

    <span class="nx">req</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span> <span class="p">});</span>
<span class="p">}</span>
</pre>
<p>This is just a small snippet to illustrate what is going on. Once you send the 
POST request, GitHub will return a response that looks like this</p>
<pre class="highlight javascript"><span class="nx">access_token</span><span class="o">=</span><span class="nx">e72e16c7e42f292c6912e7710c838347ae178b4a</span><span class="o">&amp;</span><span class="nx">token_type</span><span class="o">=</span><span class="nx">bearer</span>
</pre>
<p>From here you just need to parse the auth token and save it somewhere. 
Going forward, when you want to make an API call, you need to retrieve the 
auth token from wherever you saved it and send it along with your request.</p>

<p>Check the <a title="GitHub Documentation" href="href=&quot;http://developer.github.com/v3/">GitHub documentation</a> for more details.</p>

<p>Also, if you&#39;re looking to work with the GitHub API via Javascript, I highly 
recommend <a title="GitHub.js" href="https://github.com/michael/github">GitHub.js</a> and <a title="Gatekeeper.js" href="https://github.com/prose/gatekeeper">Gatekeeper</a>. Both have helped me immensely in 
getting this extension off the ground. I&#39;m still working on a few minor bugs 
but I&#39;m hoping to release it in the chrome store in a couple more weeks.</p>

        </div>
           <div id ="post-nav"> 
        
          <div id="previous-post">
            <a href="/It-just-worked/">It Just Worked</a> 
          </div> 
         

        
          <div id="next-post"> 
            <a href="/Hotfix/">Hotfix</a> 
        
          </div> 
        
      </div>
      </article>
    </div>
  </div>


             
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>

        <script src="/js/all.js" type="text/javascript"></script>

        <script>
            var _gaq=[['_setAccount','UA-34699920-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
           

    </body>
</html>
